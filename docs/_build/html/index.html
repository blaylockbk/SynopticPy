
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Welcome to SynopticPy Docsâ€™s documentation! &#8212; SynopticPy Docs 0.1 documentation</title>
    
  <link rel="stylesheet" href="_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    
  <link rel="preload" as="script" href="_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="https://kit.fontawesome.com/f6cc126dcc.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="shortcut icon" href="_static/wxicon.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="SynopticPy Functions" href="synoptic.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    <a class="navbar-brand" href="#">
    
      <img src="_static/SynopticPy_logo.png" class="logo" alt="logo" />
    
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="synoptic.html">SynopticPy Functions</a>
        </li>
        
        
        <li class="nav-item">
            <a class="nav-link nav-external" href="https://blaylockbk.github.io/goes2go/_build/html/">GOES-2-go<i class="fas fa-external-link-alt"></i></a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link nav-external" href="https://blaylockbk.github.io/HRRR_archive_download/_build/html/">HRRR-B<i class="fas fa-external-link-alt"></i></a>
        </li>
        
      </ul>


      

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/blaylockbk/SynopticPy" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
          <li class="nav-item">
            <a class="nav-link" href="https://twitter.com/blaylockbk" target="_blank" rel="noopener">
              <span><i class="fab fa-twitter-square"></i></span>
            </a>
          </li>
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

    <div class="bd-toc-item active">
    
  
    <ul class="nav bd-sidenav">
        
        
        
      </ul>
  
  </nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#id15" class="nav-link">â€”</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#id16" class="nav-link">â€”</a>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="welcome-to-synopticpy-docs-s-documentation">
<h1>Welcome to SynopticPy Docsâ€™s documentation!<a class="headerlink" href="#welcome-to-synopticpy-docs-s-documentation" title="Permalink to this headline">Â¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>This is a work in progress.</strong> Iâ€™m doing SynopticPy with the PyData theme
and HRRR-B with the ReadTheDocs theme.</p>
</div>
<div class="toctree-wrapper compound">
<p class="caption"><span class="caption-text">âš™ Code</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="synoptic.html">SynopticPy Functions</a></li>
</ul>
</div>
<p>ğŸ“” [Documentation](<a class="reference external" href="https://blaylockbk.github.io/SynopticPy/_build/html/">https://blaylockbk.github.io/SynopticPy/_build/html/</a>)</p>
<p><a href="#id51"><span class="problematic" id="id52">|![](https://raw.githubusercontent.com/blaylockbk/SynopticPy/master/images/Balloon_logo/balloon_bkb_sm.png)|**Brian Blaylock**&lt;br&gt;ğŸŒ [Webpage](http://home.chpc.utah.edu/~u0553130/Brian_Blaylock/home.html)&lt;br&gt; ğŸ‰This is my first PyPI package|</span></a>
<a href="#id53"><span class="problematic" id="id54">|:--|</span></a>:â€“|</p>
<p># â˜ Synoptic API for Python (_unofficial_)</p>
<p>![](<a class="reference external" href="https://raw.githubusercontent.com/blaylockbk/SynopticPy/master/images/synoptic_logo.png">https://raw.githubusercontent.com/blaylockbk/SynopticPy/master/images/synoptic_logo.png</a>)</p>
<p>The [Synoptic Mesonet API](<a class="reference external" href="https://synopticdata.com/mesonet-api">https://synopticdata.com/mesonet-api</a>) (formerly MesoWest) gives you access to real-time and historical surface-based weather and environmental observations for thousands of stations. Synoptic is _free_ up to 5,000 API requests and 5 million service units each month. Thatâ€™s a generous amount, but if you need even more data, a [paid tier](<a class="reference external" href="https://synopticdata.com/pricing">https://synopticdata.com/pricing</a>) is available (through Synoptic, not me).</p>
<p>&gt; ### ğŸŒ Register for a free account at the Synoptic API Webpage
&gt;&gt; <a class="reference external" href="https://developers.synopticdata.com">https://developers.synopticdata.com</a>
&gt;
&gt; You will need to obtain an API token before using this python package.</p>
<p>I wrote these functions to conveniently access data from the Synoptic API and convert the JSON data to a <strong>[Pandas DataFrame](https://pandas.pydata.org/docs/)</strong>. This may be helpful to others who are getting started with the Synoptic API and Python. The idea is loosely based on the obsolete [MesoPy](<a class="reference external" href="https://github.com/mesowx/MesoPy">https://github.com/mesowx/MesoPy</a>) python wrapper, but returning the data as a Pandas DataFrame instead of a simple dictionary, making the retrieved data more <em>ready-to-use</em>.</p>
<p>### Contributing Guidelines (and disclaimer)
Since this package is a work in progress, it is distributed â€œas is.â€ I do not make any guarantee it will work for you out of the box. In fact, this is my first experience publishing a package to PyPI. Any revisions I make are purely for my benefit. Sorry if I break something, but I usually only push updates to GitHub if the code is in a reasonably functional state (at least, in the way I use it).</p>
<p>With that said, I am happy to share this project with you. You are welcome to open issues and submit pull requests, but know that I may or may not get around to doing anything about it. If this is helpful to you in any way, Iâ€™m glad.</p>
<p>â€”</p>
<p># ğŸ Installation and Conda Environment
### Option 1: pip
Install the last published version from PyPI. This requires the following are already installed:
<cite>numpy</cite>, <cite>pandas</cite>, <cite>requests</cite>. Itâ€™s optional, but you will want <cite>matplotlib</cite>, and <cite>cartopy</cite>, too.</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">pip</span> <span class="pre">install</span> <span class="pre">SynopticPy</span>
<span class="pre">`</span></code></p>
<p>### Option 2: conda
If conda environments are new to you, I suggest you become familiar with [managing conda environments](<a class="reference external" href="https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html">https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html</a>).</p>
<p>I have provided a sample Anaconda [environment.yml](<a class="reference external" href="https://github.com/blaylockbk/SynopticPy/blob/master/environment.yml">https://github.com/blaylockbk/SynopticPy/blob/master/environment.yml</a>) file that lists the minimum packages required plus some extras that might be useful when working with other types of weather data. Look at the bottom lines of that yaml fileâ€¦there are two ways to install SynopticPy with pip. Comment out the lines you donâ€™t want.</p>
<p>For the latest development code:
<a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>yaml
- pip:</p>
<blockquote>
<div><ul class="simple">
<li><p>git+https://github.com/blaylockbk/SynopticPy.git</p></li>
</ul>
</div></blockquote>
<p><a href="#id5"><span class="problematic" id="id6">``</span></a>`
For the latest published version
<a href="#id7"><span class="problematic" id="id8">``</span></a><a href="#id9"><span class="problematic" id="id10">`</span></a>yaml
- pip:</p>
<blockquote>
<div><ul class="simple">
<li><p>SynopticPy</p></li>
</ul>
</div></blockquote>
<p><a href="#id11"><span class="problematic" id="id12">``</span></a><a href="#id13"><span class="problematic" id="id14">`</span></a></p>
<p>First, create the virtual environment with</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">conda</span> <span class="pre">env</span> <span class="pre">create</span> <span class="pre">-f</span> <span class="pre">environment.yml</span>
<span class="pre">`</span></code></p>
<p>Then, activate the <cite>synoptic</cite> environment. Donâ€™t confuse this _environment_ name with the _package_ name.</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">conda</span> <span class="pre">activate</span> <span class="pre">synoptic</span>
<span class="pre">`</span></code></p>
<p>Occasionally, you might want to update all the packages in the environment.</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">conda</span> <span class="pre">env</span> <span class="pre">update</span> <span class="pre">-f</span> <span class="pre">environment.yml</span>
<span class="pre">`</span></code></p>
<p>&gt; ### Alternative â€œInstallâ€ Method
&gt; There are several other ways to â€œinstallâ€ a python package so you can import them. One alternatively is you can <cite>git clone https://github.com/blaylockbk/SynopticPy.git</cite> this repository to any directory. To import the package, you will need to update your PYTHONPATH environment variable to find the directory you put this package or add the line <cite>sys.path.append(â€œ/path/to/SynotpicPyâ€)</cite> at the top of your python script.</p>
<p># ğŸ”¨ Setup</p>
<p>Before you can retrieve data from the Synoptic API, <strong>you need to register as a Synoptic user and obtain a _token_</strong>. Follow the instructions at the [Getting Started Page](<a class="reference external" href="https://developers.synopticdata.com/mesonet/v2/getting-started/">https://developers.synopticdata.com/mesonet/v2/getting-started/</a>). When you have a token, edit <cite>synoptic/config.cfg</cite> with your personal API <strong>token</strong>, _not your API <a href="#id55"><span class="problematic" id="id56">key_</span></a>.  The config file should look should look something like this:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">[Synoptic]</span>
<span class="pre">token</span> <span class="pre">=</span> <span class="pre">1234567890abcdefg</span>
<span class="pre">`</span></code></p>
<p>If you donâ€™t do this step, donâ€™t worry. When you import <cite>synoptic.services</cite>,
a quick check will make sure the token in the config file is valid. If not,
you will be prompted to update the token in the config file.</p>
<p>## ğŸ“ Jupyter Notebook Examples</p>
<p>I have provided a number of [notebooks](<a class="reference external" href="https://github.com/blaylockbk/SynopticPy/tree/master/notebooks">https://github.com/blaylockbk/SynopticPy/tree/master/notebooks</a>) on GitHub that contain some practical examples for importing and using these functions to get and show station data.</p>
<div class="section" id="id15">
<h2>â€”<a class="headerlink" href="#id15" title="Permalink to this headline">Â¶</a></h2>
<p># <cite>synoptic/</cite></p>
<p>## âš™ <cite>config.cfg</cite>
A configuration file with your Synoptic API token. This token is required to make any data request from the Synoptic API.</p>
<p>## ğŸŸ <cite>get_token.py</cite>
This function performs a test on the token in the <cite>config.cfg</cite> file. If the token is valid, you are good to go. If not, then you will be prompted to edit the <cite>config.cfg</cite> file when you import any function from <cite>synoptic.services</cite>.</p>
<p>## ğŸ‘¨ğŸ»â€ğŸ’» <cite>services.py</cite>
This is the main module you will interacti with. It contains functions for making API requests and returns the data as a Pandas DataFrame.</p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">#</span> <span class="pre">Import</span> <span class="pre">all</span> <span class="pre">functions</span>
<span class="pre">import</span> <span class="pre">synoptic.services</span> <span class="pre">as</span> <span class="pre">ss</span>
<span class="pre">`</span></code>
or
<code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">#</span> <span class="pre">Import</span> <span class="pre">a</span> <span class="pre">single</span> <span class="pre">function</span> <span class="pre">(prefered)</span>
<span class="pre">from</span> <span class="pre">synotpic.services</span> <span class="pre">import</span> <span class="pre">stations_timeseries</span>
<span class="pre">`</span></code></p>
<p>### Available Functions
There is a separate function for each of the Synoptic Mesonet API services as described in the [Synotpic documentation](<a class="reference external" href="https://developers.synopticdata.com/mesonet/v2/">https://developers.synopticdata.com/mesonet/v2/</a>).</p>
<ol class="arabic simple">
<li><dl class="simple">
<dt><cite>synoptic_api</cite> - A generalized wrapper for making an API request and returns a <cite>requests</cite> object. You <em>could</em> access the raw JSON from this object, but the other functions will convert that JSON to a Pandas DataFrame. Generally, you wonâ€™t use this function directly. The primary role of this function is to format parameter arguments to a string the request URL needs to retrieve data.</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Converts datetime input to a string</dt><dd><ul>
<li><p><cite>datetime(2020,1,1)</cite> &gt;&gt;&gt; <cite>â€œ202001010000â€</cite></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Converts timedelta input to a string</dt><dd><ul>
<li><p><cite>timedelta(hours=1)</cite> &gt;&gt;&gt; <cite>â€œ60â€</cite></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Converts lists (station IDs and variable names) to comma separated strings</dt><dd><ul>
<li><p><cite>[â€œWBBâ€, â€œKSLCâ€]</cite> &gt;&gt;&gt; <cite>â€œWBB,KSLCâ€</cite></p></li>
<li><p><cite>[â€œair_tempâ€, â€œwind_speedâ€]</cite> &gt;&gt;&gt; <cite>â€œair_temp,wind_speedâ€</cite></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ol>
<p>1. <cite>stations_metadata</cite> - Returns metadata (information) about stations. [Synoptic Docs ğŸ”—](<a class="reference external" href="https://developers.synopticdata.com/mesonet/v2/stations/metadata/">https://developers.synopticdata.com/mesonet/v2/stations/metadata/</a>)
1. <cite>stations_timeseries</cite> - Return data for a period of time. [Synoptic Docs ğŸ”—](<a class="reference external" href="https://developers.synopticdata.com/mesonet/v2/stations/timeseries/">https://developers.synopticdata.com/mesonet/v2/stations/timeseries/</a>)
1. <cite>stations_nearesttime</cite> - Return observation closest to the requested time. [Synoptic Docs ğŸ”—](<a class="reference external" href="https://developers.synopticdata.com/mesonet/v2/stations/nearesttime/">https://developers.synopticdata.com/mesonet/v2/stations/nearesttime/</a>)</p>
<p>1. <cite>stations_latest</cite> - Return the most recent observations [Synoptic Docs ğŸ”—](<a class="reference external" href="https://developers.synopticdata.com/mesonet/v2/stations/latest/">https://developers.synopticdata.com/mesonet/v2/stations/latest/</a>)
1. ğŸ— <cite>stations_precipitation</cite> - Return precipitation data (with derived quantities) [Synoptic Docs ğŸ”—](<a class="reference external" href="https://developers.synopticdata.com/mesonet/v2/stations/precipitation/">https://developers.synopticdata.com/mesonet/v2/stations/precipitation/</a>)
1. <cite>networks</cite> - Return information about networks of stations [Synoptic Docs ğŸ”—](<a class="reference external" href="https://developers.synopticdata.com/mesonet/v2/networks/">https://developers.synopticdata.com/mesonet/v2/networks/</a>)
1. <cite>networktypes</cite> - Return network category information [Synoptic Docs ğŸ”—](<a class="reference external" href="https://developers.synopticdata.com/mesonet/v2/stations/information/">https://developers.synopticdata.com/mesonet/v2/stations/information/</a>)
1. <cite>variables</cite> - Return available variables [Synoptic Docs ğŸ”—](<a class="reference external" href="https://developers.synopticdata.com/mesonet/v2/stations/variables/">https://developers.synopticdata.com/mesonet/v2/stations/variables/</a>)
1. <cite>qctypes</cite> - Return quality control information [Synoptic Docs ğŸ”—](<a class="reference external" href="https://developers.synopticdata.com/mesonet/v2/stations/qctypes/">https://developers.synopticdata.com/mesonet/v2/stations/qctypes/</a>)`
1. <cite>auth</cite> - Manage tokens (you are better off doing this in the browser in your [Synoptic profile](<a class="reference external" href="https://developers.synopticdata.com/settings/">https://developers.synopticdata.com/settings/</a>)) [Synoptic Docs ğŸ”—](<a class="reference external" href="https://developers.synopticdata.com/mesonet/v2/stations/auth/">https://developers.synopticdata.com/mesonet/v2/stations/auth/</a>)</p>
<p>1. ~~ğŸ— <cite>stations_latency</cite> - Latency information for a station [Synoptic Docs ğŸ”—](<a class="reference external" href="https://developers.synopticdata.com/mesonet/v2/stations/latency/)~~">https://developers.synopticdata.com/mesonet/v2/stations/latency/)~~</a>
1. ~~ğŸ— <cite>stations_qcsegments</cite> - Quality control for a period [Synoptic Docs ğŸ”—](<a class="reference external" href="https://developers.synopticdata.com/mesonet/v2/stations/qcsegments/)~~">https://developers.synopticdata.com/mesonet/v2/stations/qcsegments/)~~</a></p>
</div>
<div class="section" id="id16">
<h2>â€”<a class="headerlink" href="#id16" title="Permalink to this headline">Â¶</a></h2>
<p>## ğŸ§­ Function Parameters
Function arguments are stitched together to create a web query. The parameters you can use to filter the data depend on the API service. Synopticâ€™s [API Explorer](<a class="reference external" href="https://developers.synopticdata.com/mesonet/explorer/">https://developers.synopticdata.com/mesonet/explorer/</a>) can help you determine what parameters can be used for each service.</p>
<p>If the Synoptic API is new to you, I recommend you become familiar with the [Station Selector arguments](<a class="reference external" href="https://developers.synopticdata.com/mesonet/v2/station-selectors/">https://developers.synopticdata.com/mesonet/v2/station-selectors/</a>) first. These parameters key in on specific stations or a set of stations within an area of interest (<cite>stid</cite>, <cite>radius</cite>, <cite>vars</cite>, <cite>state</cite>, etc.).</p>
<p>## ğŸ¤¹ğŸ»â€â™‚ï¸ Examples
Some things you should know first:
1. All lists are joined together into a comma separated string. For instance, if you are requesting three stations, you could do <cite>stid=[â€˜WBBâ€™, â€˜KSLCâ€™, â€˜KMRYâ€™]</cite>, and that will be converted to a comma separated list <cite>stid=â€™WBB,KSLC,KMRYâ€™</cite> required for the API request URL.
1. Any input that is a datetime object (any datetime that can be parsed with f-string, <cite>fâ€™{DATE:%Y%m%d%H%M}â€™</cite>) will be converted to a string required by the API (e.g., <cite>start=datetime(2020,1,1)</cite> will be converted to <cite>start=â€™YYYYmmddHHMMâ€™</cite> when the query is made.)
1. For services that requires the <cite>within</cite> or <cite>recent</cite> arguments, these must be given in minutes. You may give integers for those arguments, but converting time to minutes is done automatically if you input a datetime.timedelta or a pandas datetime. For example, if you set <cite>within=timedelta(hours=1)</cite> or <cite>recent=pd.to_timedelta(â€˜1dâ€™)</cite>, the function will convert the value to minutes for you.</p>
<p>&gt; ### â“ What if I donâ€™t know a stationâ€™s ID?
&gt; MesoWest is your friend if you donâ€™t know what stations are available or what they are named: <a class="reference external" href="https://mesowest.utah.edu/">https://mesowest.utah.edu/</a>.</p>
<p>To get a time series of air temperature and wind speed for the last 10 hours for the William Browning Building (WBB) you can doâ€¦</p>
<p><a href="#id17"><span class="problematic" id="id18">``</span></a><a href="#id19"><span class="problematic" id="id20">`</span></a>python
from datetime import timedelta
from synotpic.services import stations_timeseries</p>
<dl class="simple">
<dt>df = stations_timeseries(stid=â€™WBBâ€™,</dt><dd><p>vars=[â€˜air_tempâ€™, â€˜wind_speedâ€™],
recent=timedelta(hours=10))</p>
</dd>
</dl>
<p><a href="#id21"><span class="problematic" id="id22">``</span></a>`
![](<a class="reference external" href="https://raw.githubusercontent.com/blaylockbk/SynopticPy/master/images/timeseries_df.png">https://raw.githubusercontent.com/blaylockbk/SynopticPy/master/images/timeseries_df.png</a>)</p>
<p>To get the latest air temperature and wind speed data for WBB (University of Utah) and KRMY (Monterey, CA airport) within one hour, we can also set the minutes as an integer instead as a timedelta.</p>
<p><a href="#id23"><span class="problematic" id="id24">``</span></a><a href="#id25"><span class="problematic" id="id26">`</span></a>python
from synotpic.services import stations_latest</p>
<dl class="simple">
<dt>df = stations_latest(stid=[â€˜WBBâ€™, â€˜KMRYâ€™],</dt><dd><p>vars=[â€˜air_tempâ€™, â€˜wind_speedâ€™],
within=60)</p>
</dd>
</dl>
<p><a href="#id27"><span class="problematic" id="id28">``</span></a>`
![](./images/latest_df.png)</p>
<p>&gt; Note: Parameters may be given as a list/datetime/timedelta, or as a string/integer interpreted by the Synoptic API. Thus,
&gt; <code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">&gt;</span> <span class="pre">stations_latest(stid='WBB,KMRY',</span>
<span class="pre">&gt;</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">vars='air_temp,wind_speed',</span>
<span class="pre">&gt;</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">within=60)</span>
<span class="pre">&gt;</span> <span class="pre">`</span></code>
&gt; is equivalent to the above example.</p>
<p>To get the air temperature and wind speed for WBB and KMRY nearest 00:00 UTC Jan 1, 2020 within one hourâ€¦</p>
<p><a href="#id29"><span class="problematic" id="id30">``</span></a><a href="#id31"><span class="problematic" id="id32">`</span></a>python
from datetime import datetime
from synotpic.services import stations_nearesttime</p>
<dl class="simple">
<dt>df = stations_latest(stid=[â€˜WBBâ€™, â€˜KMRYâ€™],</dt><dd><p>vars=[â€˜air_tempâ€™, â€˜wind_speedâ€™],
attime=datetime(2020,1,1),
within=60)</p>
</dd>
</dl>
<p><a href="#id33"><span class="problematic" id="id34">``</span></a>`
![](<a class="reference external" href="https://raw.githubusercontent.com/blaylockbk/SynopticPy/master/images/nearesttime_df.png">https://raw.githubusercontent.com/blaylockbk/SynopticPy/master/images/nearesttime_df.png</a>)</p>
<p>&gt; Note: the string/integer alternative to the above example is
&gt; <code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">&gt;</span> <span class="pre">stations_nearesttime(stid='WBB,KMRY',</span>
<span class="pre">&gt;</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">vars='air_temp,wind_speed',</span>
<span class="pre">&gt;</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">attime='2020010100',</span>
<span class="pre">&gt;</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">within=60)</span>
<span class="pre">&gt;`</span></code>
&gt; Use whichever is more convenient for you. I often use both methods. It depends on what I am doing.</p>
<p>## â™» Returned Data: Variable Names
The raw data retrieved from the Synoptic API is converted from JSON to a Pandas DataFrame.</p>
<p>If you look at the raw JSON returned, you will see that the observation values are returned as â€œsetsâ€ and â€œvaluesâ€, (e.g., <cite>air_temp_set_1</cite>, <cite>pressure_set_1d</cite>, <cite>wind_speed_value_1</cite>, etc.). This is because some stations have more than one sensor for a variable (e.g., wind at more than one level at a single site) or is reported at more than one interval (e.g., ozone at 1 hr and 15 min intervals). Time series requests return â€œsetsâ€ and nearest time requests return â€œvaluesâ€.</p>
<p>I donâ€™t really like dealing with the set and value labels. Almost always, I want the <strong>set</strong> or <strong>value</strong> with the _most_ data or the _most <a href="#id57"><span class="problematic" id="id58">recent_</span></a> observation. <strong>My functions, by default, will strip the `set_1` and `value_1` from the labels on the returned data. If there are more than one set or value, however, then the â€œsetâ€ and â€œvalueâ€ labels will be retained for those extra sets.</strong></p>
<ul class="simple">
<li><p>If a query returns <cite>air_temp_set_1</cite> and <cite>air_temp_set_2</cite>, then the labels are renamed <cite>air_temp</cite> and <cite>air_temp_set_2</cite>.</p></li>
<li><p>If a query returns <cite>pressure_set_1</cite> and <cite>pressure_set_1d</cite>, then the labels are renamed <cite>pressure_set_1</cite> and <cite>pressure</cite> _if <strong>set_1d</strong> has more observations than <a href="#id35"><span class="problematic" id="id36">**</span></a>set_1**_.</p></li>
<li><p>If a query returns <cite>dew_point_temperature_value_1</cite> at 00:00 UTC and <cite>dew_point_temperature_value_1d</cite> at 00:15 UTC are both returned, then the labels are renamed <cite>dew_point_temperature_value_1</cite> and <cite>dew_point_temperature</cite> because the derived quantity is the most recent observation available.</p></li>
</ul>
<p>In short, all sets and values are always returned, but column labels are simplified for the columns that I am most likely to use.</p>
<p>For the renamed columns, it is up to the user to know if the data is a derived quantity and which set/value it is. To find out, look for attributes â€œSENSOR_VARIABLESâ€ and â€œRENAMEâ€ in the DataFrame attributes (<cite>df.attrs</cite>), or look at the raw JSON.</p>
<p>Doing this makes sense to me, but if you are confused and donâ€™t trust what Iâ€™m doing, you can turn this â€œrelabelingâ€ off with <cite>rename_set_1=False</cite> and <cite>rename_value_1=False</cite> (for the appropriate function).</p>
<p>## ğŸŒ Latitude and Longitude
I should mention, <cite>LATITUDE</cite> and <cite>LONGITUDE</cite> in the raw JSON is renamed to <cite>latitude</cite> and <cite>longitude</cite> (lowercase) to match [CF convention](<a class="reference external" href="http://cfconventions.org/">http://cfconventions.org/</a>).</p>
<p>## ğŸ’¨ U and V Wind Components
If the returned data contains variables for both <cite>wind_speed</cite> and <cite>wind_direction</cite>, then the DataFrame will compute and return the U and V wind components as <cite>wind_u</cite> and <cite>wind_v</cite>.</p>
<p>## â² Timezone
The default timezone the data is returned is in UTC time. You may change the time to local time with the parameter <cite>obtimezone=local</cite>. Pandas will return the data with a timezone-aware index. However, I found that matplotlib plotting functions convert this time back to UTC. To plot by local time, you need to use the <cite>tz_localize(None)</cite> method to make it unaware of timezone and plot local time correctly. For example, compare the two plots created with the following:</p>
<p><a href="#id37"><span class="problematic" id="id38">``</span></a><a href="#id39"><span class="problematic" id="id40">`</span></a>python
import matplotlib.pyplot as plt
from synoptic.services import stations_timeseries</p>
<dl class="simple">
<dt>df = stations_timeseries(stid=â€™KSLCâ€™,</dt><dd><p>recent=1000,
obtimezone=â€™localâ€™,
vars=â€™air_tempâ€™)</p>
</dd>
</dl>
<p>plt.plot(df.index, df.air_temp, label=â€™tz aware (plots in UTC)â€™)
plt.plot(df.index.tz_localize(None), df.air_temp, label=â€™tz unaware (as local time)â€™)
plt.legend()
<a href="#id41"><span class="problematic" id="id42">``</span></a>`
![](<a class="reference external" href="https://raw.githubusercontent.com/blaylockbk/SynopticPy/master//images/tz_localize.png">https://raw.githubusercontent.com/blaylockbk/SynopticPy/master//images/tz_localize.png</a>)</p>
<p>## âœ… How to set Synopticâ€™s quality control checks
By default, only basic QC range checks are applied to the data before it is returned by the API. These basic checks remove physically implausible data like removing a 300 degree temperature instead of returning the value.</p>
<p>You can add additional QC checks that more stringently remove â€œbadâ€ data that might not be representative of the area or caused by a faulty sensor. However, you canâ€™t expect every bad observation will be removed (or every good observation will be retained).</p>
<ul class="simple">
<li><p>[Read about the QC checks](<a class="reference external" href="https://developers.synopticdata.com/about/qc/">https://developers.synopticdata.com/about/qc/</a>)</p></li>
<li><p>[Read the QC section for a stations service (e.g., timeseries)](<a class="reference external" href="https://developers.synopticdata.com/mesonet/v2/stations/timeseries/">https://developers.synopticdata.com/mesonet/v2/stations/timeseries/</a>)</p></li>
</ul>
<p>Some tips:</p>
<ul class="simple">
<li><p>You can turn on more QC checks by Synoptic with the parameter <cite>qc_checks=â€™synopticlabsâ€™</cite></p></li>
<li><p>You can turn all QC checks on (includes synopiclab, mesowest, and madis checks) with the parameter <cite>qc_checks=â€™allâ€™</cite>.</p></li>
<li><p>You can see the number of data point removed in the QC summary in the DataFrame attributes <cite>df.attrs[â€˜QC_SUMMARYâ€™]</cite>.</p></li>
<li><p>Specific checks can be turned on (read the docs for more details).</p></li>
</ul>
<p>For example:</p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">df</span> <span class="pre">=</span> <span class="pre">stations_timeseries(stid='UKBKB',</span> <span class="pre">recent=60,</span> <span class="pre">qc_checks='synopticlabs')</span>
<span class="pre">`</span></code>
or
<code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">df</span> <span class="pre">=</span> <span class="pre">stations_timeseries(stid='UKBKB',</span> <span class="pre">recent=60,</span> <span class="pre">qc_checks='all')</span>
<span class="pre">`</span></code></p>
<p>Look at the QC_SUMMARY in the DataFrame attributes to see some info about
what each QC check means and how many are flaggedâ€¦
<a href="#id43"><span class="problematic" id="id44">``</span></a><a href="#id45"><span class="problematic" id="id46">`</span></a>python
df.attrs[â€˜QC_SUMMARYâ€™]
&gt;&gt;&gt;{â€˜QC_SHORTNAMESâ€™: {â€˜18â€™: â€˜ma_stat_cons_checkâ€™, â€˜16â€™: â€˜ma_temp_cons_checkâ€™},</p>
<blockquote>
<div><p>â€˜QC_CHECKS_APPLIEDâ€™: [â€˜allâ€™],
â€˜PERCENT_OF_TOTAL_OBSERVATIONS_FLAGGEDâ€™: 2.03,
â€˜QC_SOURCENAMESâ€™: {â€˜18â€™: â€˜MADISâ€™, â€˜16â€™: â€˜MADISâ€™},
â€˜TOTAL_OBSERVATIONS_FLAGGEDâ€™: 750.0,
â€˜QC_NAMESâ€™: {â€˜18â€™: â€˜MADIS Spatial Consistency Checkâ€™, â€˜16â€™: â€˜MADIS Temporal Consistency Checkâ€™}}</p>
</div></blockquote>
<p><a href="#id47"><span class="problematic" id="id48">``</span></a><a href="#id49"><span class="problematic" id="id50">`</span></a></p>
<p>You might be able to find a better way to mask out those QCâ€™ed values, but here is one method for the QC check for <em>wind_speed_set_1</em>:</p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">#</span> <span class="pre">Identify</span> <span class="pre">which</span> <span class="pre">ones</span> <span class="pre">&quot;passed&quot;</span> <span class="pre">the</span> <span class="pre">QC</span> <span class="pre">checks</span> <span class="pre">(these</span> <span class="pre">have</span> <span class="pre">None</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">QC</span> <span class="pre">array)</span>
<span class="pre">qc_mask</span> <span class="pre">=</span> <span class="pre">np.array([x</span> <span class="pre">is</span> <span class="pre">None</span> <span class="pre">for</span> <span class="pre">x</span> <span class="pre">in</span> <span class="pre">df.attrs['QC']['wind_speed_set_1']])</span>
<span class="pre">df</span> <span class="pre">=</span> <span class="pre">df.loc[qc_mask]</span>
<span class="pre">`</span></code></p>
<p>## ğŸ“ˆ <cite>plots.py</cite>
### <strong>*These are a work in progress*</strong>
Some helpers for plotting data from the Synoptic API.</p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">#</span> <span class="pre">Import</span> <span class="pre">all</span> <span class="pre">functions</span>
<span class="pre">import</span> <span class="pre">synoptic.plots</span> <span class="pre">as</span> <span class="pre">sp</span>
<span class="pre">`</span></code>
or
<code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">#</span> <span class="pre">Import</span> <span class="pre">individual</span> <span class="pre">functions</span>
<span class="pre">from</span> <span class="pre">synoptic.plots</span> <span class="pre">import</span> <span class="pre">plot_timeseries</span>
<span class="pre">`</span></code></p>
<p>â€”</p>
<p>If you have stumbled across this package, I hope it is useful to you or at least gives you some ideas.</p>
<p><strong>Best of Luck ğŸ€</strong>
-Brian</p>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='right-next' id="next-link" href="synoptic.html" title="next page">SynopticPy Functions</a>

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="_static/js/index.3da636dd464baa7582d2.js"></script>


    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2021, Brian K. Blaylock.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.4.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>